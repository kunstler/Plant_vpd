packages:
  - plant
  - plant.assembly
  - loggr
  - rmarkdown
  - RColorBrewer
  - smatr
  - raster
  - gtools
  - dplyr
  - TheoTradeOff
  - reldist

sources:
  - R

plot_options:
  tall:
    height: 6.5
    width: 5.5
  wide:
    height: 3.5
    width: 7
  skinny:
    height: 4.5
    width: 3
  square:
    height: 5.5
    width: 5.5
  large_square:
    height: 7
    width: 7

knitr_options:
  vignette:
    auto_figure_prefix: true
    chdir: true

targets:
  all:
    depends:
      - ms/ideas.pdf
      - ms/literature.pdf

  ms/ideas.pdf:
    depends:
      - ms/ms.sty
      - ms/amnat.bst
    command: latex_build("ms/ideas.tex", "ms/references.bib", clean=TRUE)

  ms/literature.pdf:
    depends:
      - ms/ms.sty
      - ms/amnat.bst
    command: latex_build("ms/literature.tex", "ms/references.bib", clean=TRUE)

  ms/abstract_sfe.pdf:
    depends:
      - ms/ms.sty
    command: latex_build("ms/abstract_sfe.tex", clean=TRUE)

  slides.pdf:
    command: xelatex_build_clean("slides.tex")

  figures:
    depends:
    - figures/tradeoff_shade_light.pdf
    - figures/data_climate.pdf
    - figures/data_lma_ll_trade_off.pdf
    - figures/data_lma_ll_trade_off_climate_elev_T_P.pdf
    - figures/data_lma_ll_trade_off_climate_elev_P.pdf
    - figures/data_lma_ll_trade_off_climate_elev_T.pdf
    - figures/data_lma_ll_trade_off_climate_slope_elev.pdf
    - figures/data_B_kl_climate.pdf
    - figures/fitness_lma_single.pdf
    - figures/fitness_lma_multi.pdf
    - figures/gradient_lma_single.pdf
    - figures/gradient_lma_multi.pdf
    - figures/wood_climate.pdf
    - figures/resLV_1.pdf
    - figures/resLV_2.pdf
    - figures/resLV_0a.pdf
    - figures/resLV_0b.pdf

  param:
    depends:
    - param_slope_P
    - param_slope_TP

# Simulation results and figures ###################################################

#### LV for intro
  figures/resLV_0a.pdf:
    command: plot_intro_fig_0a(df_pred)

  figures/resLV_0b.pdf:
    command: plot_intro_fig_0b(df_pred)

  figures/resLV_1.pdf:
    command: plot_intro_fig_1(df_pred)

  figures/resLV_2.pdf:
    command: plot_intro_fig_2(df_pred)

  df_pred:
    command: data_intro_fig()

### TheoTradeOff

  list_init:
    command: generate_init()

  l_res_K100:
    command: run_K(list_init, I(K = 100))

  l_res_K10:
    command: run_K(list_init, I(K = 10))

  l_res_K5:
    command: run_K(list_init, I(K = 5))

  l_res_K1:
    command: run_K(list_init, I(K = 1))

  figures/map_theo_K100.pdf:
    command: plot_map(l_res_K100, list_init, I(val_K = 100))
    plot: wide

  figures/map_theo_K10.pdf:
    command: plot_map(l_res_K10, list_init, I(val_K = 10))
    plot: wide

  figures/map_theo_K5.pdf:
    command: plot_map(l_res_K5, list_init, I(val_K = 5))
    plot: wide

  figures/map_theo_K1.pdf:
    command: plot_map(l_res_K1, list_init, I(val_K = 1))
    plot: wide


## Plant simuls

  figures/tradeoff_shade_light.pdf:
    command: plot_lma_shade_tradeoff()
    plot: square

  figures/WaterS_LeafN_contour.pdf:
    command: plot_contour_waterStress_LeafN(res_photo)
    plot: square

  figures/WaterS_LeafN.pdf:
    command: plot_water_LeafN()
    plot: square

  res_photo:
    command: data_contour()

  figures/fitness_lma_single.pdf:
    command: plot_fitness_assembly(list_assembly_lma_single, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/fitness_lma_multi.pdf:
    command: plot_fitness_assembly(list_assembly_lma_multi, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/gradient_lma_single.pdf:
    command: plot_trait_gradient(list_assembly_lma_single, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/gradient_lma_multi.pdf:
    command: plot_trait_gradient(list_assembly_lma_multi, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/gradient_lma_single_elev.pdf:
    command: plot_trait_gradient(list_assembly_lma_single_elev, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/gradient_lma_multi_elev.pdf:
    command: plot_trait_gradient(list_assembly_lma_multi_elev, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ))
    plot: square

  figures/gradient_lma_single_slope.pdf:
    command: plot_trait_gradient(list_assembly_lma_single_slope, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/gradient_lma_multi_slope.pdf:
    command: plot_trait_gradient(list_assembly_lma_multi_slope, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ))
    plot: square

  figures/gradient_lma_single_narea_lma.pdf:
    command: plot_trait_gradient(list_assembly_lma_single_narea_lma, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)))
    plot: square

  figures/gradient_lma_multi_narea_lma.pdf:
    command: plot_trait_gradient(list_assembly_lma_multi_narea_lma, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ))
    plot: square

  figures/gradient_narea_single.pdf:
    command: plot_trait_gradient(list_assembly_lma_single_narea, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)), I(var = "narea"), I(varlab = expression(paste("Nitrogen per area (kg ", m^-2,")"))))
    plot: square

  figures/gradient_narea_multi.pdf:
    command: plot_trait_gradient(list_assembly_lma_multi_narea, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(var = "narea"), I(varlab = expression(paste("Nitrogen per area (kg ", m^-2,")"))))
    plot: square

  figures/gradient_narea_single_narea_lma.pdf:
    command: plot_trait_gradient(list_assembly_lma_single_narea_lma, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3)), I(var = "narea"), I(varlab = expression(paste("Nitrogen per area (kg ", m^-2,")"))))
    plot: square

  figures/gradient_narea_multi_narea_lma.pdf:
    command: plot_trait_gradient(list_assembly_lma_multi_narea_lma, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(var = "narea"), I(varlab = expression(paste("Nitrogen per area (kg ", m^-2,")"))))
    plot: square

  figures/gradient_narea_lma_multi_narea_lma.pdf:
    command: plot_trait_gradient_narea_lma(list_assembly_lma_multi_narea_lma, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ))
    plot: square

  figures/gradient_narea_lma_multi_narea_lma2.pdf:
    command: plot_trait_gradient_narea_lma2(list_assembly_lma_multi_narea_lma, I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ))
    plot: large_square

  list_assembly_lma_single:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), disturbance_mean_interval = 5)
    check: exists
    cleanup_level: purge

  list_assembly_lma_multi:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), disturbance_mean_interval = 40)
    check: exists
    cleanup_level: purge

  list_assembly_lma_single_elev:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_elev), disturbance_mean_interval = 5, data_param = param_slope_P)
    check: exists
    cleanup_level: purge

  list_assembly_lma_multi_elev:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_elev), disturbance_mean_interval = 40, data_param = param_slope_P)
    check: exists
    cleanup_level: purge

  list_assembly_lma_single_slope:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_slope), disturbance_mean_interval = 5, data_param = param_slope_TP)
    check: exists
    cleanup_level: purge

  list_assembly_lma_multi_slope:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_slope), disturbance_mean_interval = 40, data_param = param_slope_TP)
    check: exists
    cleanup_level: purge

  list_assembly_lma_single_narea:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_narea), disturbance_mean_interval = 5)
    check: exists
    cleanup_level: purge

  list_assembly_lma_multi_narea:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_narea), disturbance_mean_interval = 40)
    check: exists
    cleanup_level: purge

  list_assembly_lma_multi_narea_short:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.15, 0.0, 0.15, 0.3) ), I(FUN = run_assembly_narea), disturbance_mean_interval = 40)
    check: exists
    cleanup_level: purge

  list_assembly_lma_single_narea_lma:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_narea_lma), disturbance_mean_interval = 5)
    check: exists
    cleanup_level: purge

  list_assembly_lma_multi_narea_lma:
    command: run_assembly_list(I(vec_site_prod = c(-0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3) ), I(FUN = run_assembly_narea_lma), disturbance_mean_interval = 40)
    check: exists
    cleanup_level: purge

# Data sources and figures  ###################################################

  figures/data_climate.pdf:
    command: figure_lma_climate(leaf_traits)
    plot: large_square

  figures/data_lma_ll_trade_off.pdf:
    command: figure_lma_tradeoff(leaf_traits)
    plot: square

  figures/data_lma_ll_trade_off_climate_elev_T_P.pdf:
    command: figure_lma_tradeoff_climate(leaf_traits)
    plot: tall

  figures/data_lma_ll_trade_off_climate_elev_P.pdf:
    command: figure_lma_tradeoff_climate(leaf_traits, I(var_clim = 'map'))
    plot: tall

  figures/data_lma_ll_trade_off_climate_elev_T.pdf:
    command: figure_lma_tradeoff_climate(leaf_traits, I(var_clim = 'mat'))
    plot: tall

  figures/data_lma_ll_trade_off_climate_slope_elev.pdf:
    command: figure_lma_tradeoff_climate_slope(leaf_traits)
    plot: tall

  figures/data_B_kl_climate.pdf:
    command: figure_B_kl_climate(leaf_traits)
    plot: wide

  figures/wood_climate.pdf:
    command: plot_wood_clim(zanne_clim)
    plot: wide

  param_slope_P:
    command: param_B_kl_climate_P(leaf_traits)

  param_slope_TP:
    command: param_B_kl_climate_TP(leaf_traits)

  leaf_traits:
    packages: xlsx
    command: >
      process_wright_2004("download/wright-2004.xls",
                          "data/wright_2004_locations.csv")

  zanne_clim:
    command: get_climate_niche(zanne, worldclim)
    packages:
      - parallel
      - rgbif
      - dismo

  zanne:
    packages: xlsx
    command: process_zanne_2010("download/zanne-2010.xls")

  olson:
    packages: xlsx
    command: process_olson_2010("download/olson-2014.xls")

  worldclim:
    command: getData(I('worldclim'), var = I('bio'), res = 2.5, path=I("download"))
    packages: raster

  download/wright-2004.xls:
    download: "http://www.nature.com/nature/journal/v428/n6985/extref/nature02403-s2.xls"

  download/zanne-2010.xls:
    download: "https://datadryad.org/bitstream/handle/10255/dryad.1139/GlobalVesselAnatomyDatabase.xls?sequence=1"

  download/olson-2014.xls:
    download: "http://api.onlinelibrary.wiley.com/asset/v1/doi/10.1111%2Fele.12302/asset/supinfo%2Fele12302-sup-0001-AppendixS1.xls?l=j6%2BNsqLlmq%2FUmTwPXEFuIHuWIDkoh16bdSPkBsbx1JqrIriGYfLAO23oVGh0yhC%2B91BwN0ZWzMJL%0Amf%2BX2bFUKS64r5EDpuQ9"
