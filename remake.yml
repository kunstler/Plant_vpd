packages:
  - plant
  - plant.assembly
  - loggr
  - rmarkdown
  - RColorBrewer
  - smatr
  - raster
  - gtools
  - dplyr
  - dismo
  - rgbif
  - parallel

sources:
  - R

plot_options:
  tall:
    height: 6.5
    width: 5.5
  wide:
    height: 3.5
    width: 7
  skinny:
    height: 4.5
    width: 3
  square:
    height: 5.5
    width: 5.5
  large_square:
    height: 7
    width: 7

knitr_options:
  vignette:
    auto_figure_prefix: true
    chdir: true

targets:
  all:
    depends:
      - ms/ideas.pdf
      - ms/literature.pdf

  ms/ideas.pdf:
    depends:
      - ms/ms.sty
      - ms/amnat.bst
    command: latex_build("ms/ideas.tex", "ms/references.bib", clean=TRUE)

  ms/literature.pdf:
    depends:
      - ms/ms.sty
      - ms/amnat.bst
    command: latex_build("ms/literature.tex", "ms/references.bib", clean=TRUE)

  figures:
    depends:
    - figures/data_climate.pdf
    - figures/data_lma_ll_trade_off.pdf
    - figures/data_lma_ll_trade_off_climate_loc.pdf
    - figures/data_lma_ll_trade_off_climate_lev.pdf
    - figures/data_lma_ll_trade_off_climate_slope_elev.pdf
    - figures/data_B_kl_climate.pdf
    - figures/fitness_lma_single.pdf
    - figures/fitness_lma_multi.pdf
    - figures/gradient_lma_single.pdf
    - figures/gradient_lma_multi.pdf
    - figures/wood_climate.pdf

# Simulation results and figures ###################################################

  figures/fitness_lma_single.pdf:
    command: plot_fitness_assembly(assembly_lma_single_1, assembly_lma_single_2, assembly_lma_single_3)
    plot: square

  figures/fitness_lma_multi.pdf:
    command: plot_fitness_assembly(assembly_lma_multi_1, assembly_lma_multi_2, assembly_lma_multi_3)
    plot: square

  figures/gradient_lma_single.pdf:
    command: plot_trait_gradient(assembly_lma_single_1, assembly_lma_single_2, assembly_lma_single_3)
    plot: square

  figures/gradient_lma_multi.pdf:
    command: plot_trait_gradient(assembly_lma_multi_1, assembly_lma_multi_2, assembly_lma_multi_3)
    plot: square

  assembly_lma_single_1:
    command: run_assembly(disturbance_mean_interval=5, site_prod=0.8)
    check: exists
    cleanup_level: purge

  assembly_lma_single_2:
    command: run_assembly(disturbance_mean_interval=5, site_prod=1.0)
    check: exists
    cleanup_level: purge

  assembly_lma_single_3:
    command: run_assembly(disturbance_mean_interval=5, site_prod=1.2)
    check: exists
    cleanup_level: purge

  assembly_lma_multi_1:
    command: run_assembly(disturbance_mean_interval=40, site_prod=0.8)
    check: exists
    cleanup_level: purge

  assembly_lma_multi_2:
    command: run_assembly(disturbance_mean_interval=40, site_prod=1.0)
    check: exists
    cleanup_level: purge

  assembly_lma_multi_3:
    command: run_assembly(disturbance_mean_interval=40, site_prod=1.2)
    check: exists
    cleanup_level: purge

# Data sources and figures  ###################################################

  figures/data_climate.pdf:
    command: figure_lma_climate(leaf_traits)
    plot: large_square

  figures/data_lma_ll_trade_off.pdf:
    command: figure_lma_tradeoff(leaf_traits)
    plot: square

  figures/data_lma_ll_trade_off_climate_loc.pdf:
    command: figure_lma_tradeoff_climate(leaf_traits)
    plot: tall

  figures/data_lma_ll_trade_off_climate_lev.pdf:
    command: figure_lma_tradeoff_climate(leaf_traits, I(group_name = 'levels'))
    plot: tall

  figures/data_lma_ll_trade_off_climate_slope_elev.pdf:
    command: figure_lma_tradeoff_climate_slope_elev(leaf_traits)
    plot: tall

  figures/data_B_kl_climate.pdf:
    command: figure_B_kl_climate(leaf_traits)
    plot: wide

  figures/wood_climate.pdf:
    command: plot_wood_clim(wood_clim)
    plot: wide


  leaf_traits:
    packages: xlsx
    command: >
      process_wright_2004("download/wright-2004.xls",
                          "data/wright_2004_locations.csv")

  wood_clim:
    command: get_climate_niche(wood, wc)

  wood:
    packages: xlsx
    command: >
      process_zanne_2010("download/zanne-2010.xls")

  wc:
    command: >
      get_wc()

  download/wright-2004.xls:
    download: "http://www.nature.com/nature/journal/v428/n6985/extref/nature02403-s2.xls"

  download/zanne-2010.xls:
    download: "https://datadryad.org/bitstream/handle/10255/dryad.1139/GlobalVesselAnatomyDatabase.xls?sequence=1"

  download/bio1_9_30s_bil.zip:
    download: "http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/grid/cur/bio1-9_30s_bil.zip"

  download/bio10_19_30s_bil.zip:
    download: "http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/grid/cur/bio10-19_30s_bil.zip"
